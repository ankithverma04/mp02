{% extends "base.html" %}

{% block title %}Sign Up - Technical Interview Platform{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center px-4 py-12">
    <div class="w-full max-w-md">
        <div class="card-light dark-mode:card-dark p-8 rounded-2xl shadow-lg">
            <h2 class="text-3xl font-bold mb-6 text-center text-gray-800 dark-mode:text-gray-200">
                Create Account
            </h2>

            <form method="POST" action="{{ url_for('signup') }}" id="signup-form" novalidate>
                <div class="mb-4">
                    <label for="name" class="block text-sm font-semibold mb-2 text-gray-700 dark-mode:text-gray-300">
                        Name
                    </label>
                    <input 
                        type="text" 
                        id="name" 
                        name="name" 
                        value="{{ name if name else '' }}"
                        required
                        aria-label="Enter your full name"
                        class="input-field input-field-light dark-mode:input-field-dark w-full px-4 py-3 border border-gray-300 dark-mode:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="John Doe">
                    <span id="name-error" class="text-red-500 text-sm mt-1 hidden"></span>
                </div>

                <div class="mb-4">
                    <label for="email" class="block text-sm font-semibold mb-2 text-gray-700 dark-mode:text-gray-300">
                        Email
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        value="{{ email if email else '' }}"
                        required
                        aria-label="Enter your email address"
                        class="input-field input-field-light dark-mode:input-field-dark w-full px-4 py-3 border border-gray-300 dark-mode:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="john@example.com">
                    <span id="email-error" class="text-red-500 text-sm mt-1 hidden"></span>
                </div>

                <div class="mb-4">
                    <label for="password" class="block text-sm font-semibold mb-2 text-gray-700 dark-mode:text-gray-300">
                        Password
                    </label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required
                        aria-label="Enter your password"
                        class="input-field input-field-light dark-mode:input-field-dark w-full px-4 py-3 border border-gray-300 dark-mode:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="At least 8 characters">
                    <span id="password-error" class="text-red-500 text-sm mt-1 hidden"></span>
                    <p class="text-xs text-gray-500 dark-mode:text-gray-400 mt-1">
                        Must be at least 8 characters with one number and one special character
                    </p>
                </div>

                <div class="mb-6">
                    <label for="confirm_password" class="block text-sm font-semibold mb-2 text-gray-700 dark-mode:text-gray-300">
                        Confirm Password
                    </label>
                    <input 
                        type="password" 
                        id="confirm_password" 
                        name="confirm_password" 
                        required
                        aria-label="Confirm your password"
                        class="input-field input-field-light dark-mode:input-field-dark w-full px-4 py-3 border border-gray-300 dark-mode:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Re-enter your password">
                    <span id="confirm-password-error" class="text-red-500 text-sm mt-1 hidden"></span>
                </div>

                <button 
                    type="submit" 
                    class="btn-primary text-white font-semibold py-3 px-6 w-full rounded-[1.3rem] hover:shadow-lg transition-shadow"
                    aria-label="Submit sign up form">
                    Sign Up
                </button>
            </form>

            <p class="mt-6 text-center text-sm text-gray-600 dark-mode:text-gray-400">
                Already have an account? 
                <a href="{{ url_for('signin') }}" class="text-blue-600 dark-mode:text-blue-400 hover:underline font-semibold">
                    Sign In
                </a>
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Email validation regex
    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

    // Password validation
    function validatePassword(password) {
        if (password.length < 8) {
            return { valid: false, message: 'Password must be at least 8 characters long' };
        }
        if (!/\d/.test(password)) {
            return { valid: false, message: 'Password must contain at least one number' };
        }
        if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
            return { valid: false, message: 'Password must contain at least one special character' };
        }
        return { valid: true, message: '' };
    }

    function showError(fieldId, message) {
        const errorSpan = document.getElementById(fieldId + '-error');
        if (errorSpan) {
            errorSpan.textContent = message;
            errorSpan.classList.remove('hidden');
        }
        const field = document.getElementById(fieldId);
        if (field) {
            field.classList.add('border-red-500');
        }
    }

    function clearError(fieldId) {
        const errorSpan = document.getElementById(fieldId + '-error');
        if (errorSpan) {
            errorSpan.classList.add('hidden');
        }
        const field = document.getElementById(fieldId);
        if (field) {
            field.classList.remove('border-red-500');
        }
    }

    document.getElementById('signup-form').addEventListener('submit', function(e) {
        let isValid = true;

        // Validate name
        const name = document.getElementById('name').value.trim();
        if (!name) {
            showError('name', 'Name is required');
            isValid = false;
        } else {
            clearError('name');
        }

        // Validate email
        const email = document.getElementById('email').value.trim();
        if (!email) {
            showError('email', 'Email is required');
            isValid = false;
        } else if (!emailRegex.test(email)) {
            showError('email', 'Please enter a valid email address');
            isValid = false;
        } else {
            clearError('email');
        }

        // Validate password
        const password = document.getElementById('password').value;
        const passwordValidation = validatePassword(password);
        if (!passwordValidation.valid) {
            showError('password', passwordValidation.message);
            isValid = false;
        } else {
            clearError('password');
        }

        // Validate confirm password
        const confirmPassword = document.getElementById('confirm_password').value;
        if (!confirmPassword) {
            showError('confirm-password', 'Please confirm your password');
            isValid = false;
        } else if (password !== confirmPassword) {
            showError('confirm-password', 'Passwords do not match');
            isValid = false;
        } else {
            clearError('confirm-password');
        }

        if (!isValid) {
            e.preventDefault();
        }
    });

    // Real-time validation
    document.getElementById('email').addEventListener('blur', function() {
        const email = this.value.trim();
        if (email && !emailRegex.test(email)) {
            showError('email', 'Please enter a valid email address');
        } else {
            clearError('email');
        }
    });

    document.getElementById('password').addEventListener('blur', function() {
        const password = this.value;
        if (password) {
            const validation = validatePassword(password);
            if (!validation.valid) {
                showError('password', validation.message);
            } else {
                clearError('password');
            }
        }
    });

    document.getElementById('confirm_password').addEventListener('blur', function() {
        const password = document.getElementById('password').value;
        const confirmPassword = this.value;
        if (confirmPassword && password !== confirmPassword) {
            showError('confirm-password', 'Passwords do not match');
        } else {
            clearError('confirm-password');
        }
    });
</script>
{% endblock %}


